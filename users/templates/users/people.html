{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2>People</h2>
<div class="row">
  {% for p in people %}
  {% with u=p.user %}
  <div class="col-md-4 mb-3">
    <div class="card h-100 shadow-sm"> {% if u.profile_picture %}
      <img 
          src="{{ u.profile_picture.url }}" 
          class="card-img-top" 
          alt="{{ u.username }}"
          style="height: 250px; object-fit: cover; object-position: center;"> 
      {% else %}
      <img 
          src="/media/profile_pics/default_pic.jpeg" 
          class="card-img-top" 
          alt="{{ u.username }}"
          style="height: 250px; object-fit: cover; object-position: center;">
      {% endif %}

      <div class="card-body d-flex flex-column"> <h5 class="card-title"><a href="{% url 'users:user_profile' u.pk %}">{{ u.get_full_name|default:u.username }}</a></h5>
        <p class="card-text text-muted">@{{ u.username }}</p>

        <div class="mt-auto"> {% if p.status == 'friends' %}
            <button class="btn btn-secondary w-100" disabled>Friends</button>
          {% elif p.status == 'sent' %}
            <form method="post" action="{% url 'users:respond_friend_request' p.request_pk 'cancel' %}">
              {% csrf_token %}
              <button class="btn btn-outline-warning w-100" type="submit">Cancel Request</button>
            </form>
          {% elif p.status == 'received' %}
            <div class="d-flex gap-2"> <form method="post" class="flex-grow-1" action="{% url 'users:respond_friend_request' p.request_pk 'accept' %}"> {% csrf_token %}
                <button class="btn btn-primary w-100" type="submit">Accept</button>
              </form>
              <form method="post" class="flex-grow-1" action="{% url 'users:respond_friend_request' p.request_pk 'reject' %}"> {% csrf_token %}
                <button class="btn btn-danger w-100" type="submit">Reject</button>
              </form>
            </div>
          {% else %}
            <form method="post" action="{% url 'users:send_friend_request' u.pk %}"> {% csrf_token %}
              <button class="btn btn-success w-100" type="submit">Add Friend</button>
            </form>
          {% endif %}
        </div>

      </div>
    </div>
  </div>
  {% endwith %}
  {% empty %}
  <p>No other users found.</p>
  {% endfor %}
</div>
{% endblock %}